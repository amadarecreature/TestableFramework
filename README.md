# TestableWebFramework

This framework is emphasizes testability.

## テストとは

プログラムが主観的もしくは客観的な視点で仕様を満たしていることを保証する（妥当性を担保する）作業をテストと定義する。
目的も同様に「客観的に仕様を満たしていることを保証する」こととする。

UT/IT/STなどシステム開発におけるテストの種類は色々あるが、いずれの場合もテストを行う目的は変わらない。
※ただし、実施方法は保証する基準などが種類に応じて変わってくる。

主観的、客観的な視点とはテストケースの抽出方法でいえば、主観的=ホワイトボックス、客観的=ブラックボックスといえる。

基本的に客観的な視点で

### ユニットテストの作り方

#### ユニットの属性とそのテスト方法

厳密にいえばすべてユニットごとの機能であるが、概念として属性を分けてみる。

- 構造・・・ユニットごとに機能を分離した場合、その使い方、関係性の妥当性を担保する必要がある。interfaceだけではで強制できない部分
- 機能・・・各メソッドに期待される機能。構造を含んで実現されるため、一部構造の確認にも入る。

##### 構造

構造については、テスト対象ユニットで実現される機能の妥当性とは関係がない。が、クラス構造などの設計思想を維持するために、それが正しく適用されているかを担保する必要がある。
ブラックボックスでは確認できない為、ホワイトボックスの観点でテストが必要になる。なので、テスト方法としては特定のクラスに対しては、こういう構造テストが必要、というようなテストのテンプレートが必要になる。

構造については極力interfaceで制御したいが、それだけでは制御できない部分をこのテストで静的チェックを行うイメージ。
ユニット間のITと同等とも言える。

##### 機能

各ユニットに期待される機能を担保する。期待されるものは、インプットに対するアウトプットであるが、その確認はブラックボックス観点で担保される。
つまり、特定のインプットに対して特定のアウトプットが返されることを担保する。
アウトプットの種類は、単純な返り値、DBの更新、ファイル出力などさまざまな形式が存在する。

##### アウトプットの形式

アウトプットの出力形式を汎化して利用者がその形式の違いを意識しなくて済めばアウトプットの確認が容易になる。
つまり、自動的にテストしやすくなる。
一番自動的な確認の難しいアウトプットがGUI。
このアウトプット作成処理とそれ以外の処理とをどれだけ分離するかで、GUIありの機能のテスト容易性が大きく変わってくる。

この「特定のインプット」、「特定のアウトプット」を制御するには構造的に対象のユニットに対して、厳密にインプットの範囲を指定することができ、そのアウトプットも同様に影響範囲を指定できることが前提となる。

たとえば、インプットが引数とDBであれば、引数はメソッド引数のみ、DBアクセスは特定のルールに従ったサービスクラスからのみ行うなどの制限をかける。
この構造を担保するために、前述の「構造」をテストで担保することが必要となる。

#### interfaceの分離

アプリケーション内で、さまざまなデータにアクセスするがそのデータ構造について、複数の操作方法を提供しない。

データはjavaならjavaないでの都合に合わせたデータのみ使う。
そこにデータベースの構造が出てこないようにする。
ただ、その境界線では混ざるため、interfaceを切り分けてそこの依存をなくす。
DBの構造が表に出てくる層をserviceの内部ロジックまでとし、その利用者はDBの存在を意識しなくて済むようにする。
※リレーションなど。
ただし、業務的な都合。
契約情報があって、それに対する異動申し込みなど。
はjavaであつかう。

### Agile開発の有用性

Agile開発では、すべての機能を一括で開発するのではなく、短い期間で一部機能を完成させその積み重ねで最終成果物（目的）を完成させる。

・最小単位が、顧客にとって有用なユーザーストーリーと一致すればよいが、そうでないケースもある。
・何をもって完了するか、その範囲内の機能が要件通りであることをブラックボックステストで確認し終えた状態。
・テストにおいて、最終成果物で求められる品質を各機能単位で担保する必要はない。
　ただし、機能単位で標準的に満たすべき品質もあるため、その基準は必要。
　性能問題などは、最終成果物で起こるであろう問題を各機能の開発で明示的につぶすことはできない。
　※TODO:ここはデータが必要。性能問題の原因の多い内訳探す。

### 関心の分離

<https://qiita.com/os1ma/items/66fb47f229896b32b2e8>

### バッチ、テスト

処理の階層、大きい単位別にテストしたい。

引数チェック、共通的な終了判定などは、他の条件分岐と完全に分離して、メインロジックの条件分岐と組み合わせなくて済むよう明示的に分ける。

必ずしもそのレベルで必要な処理がそれだけとは限らないので、
階層を示すインターフェィスを用意するのはありかもしれない。
